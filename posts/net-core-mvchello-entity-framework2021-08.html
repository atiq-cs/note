<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Head&#x27;s in the cloud! A Qubit Blog!">

  <title>Notes from Qubit Inc. - dotnet core Hello World with Entity Framework and Database</title>

  <link rel="canonical" href="https://note.iqubit.xyz/posts/net-core-mvchello-entity-framework2021-08">

      <link type="application/rss+xml" rel="alternate" href="/feed.rss" />
      <link type="application/atom+xml" rel="alternate" href="/feed.atom" />
  
  <meta name="application-name" content="Notes from Qubit Inc." />
  <meta name="msapplication-tooltip" content="Notes from Qubit Inc." />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Notes from Qubit Inc. - dotnet core Hello World with Entity Framework and Database" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://note.iqubit.xyz/posts/net-core-mvchello-entity-framework2021-08" />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <!-- Bootstrap core CSS -->
  <link href="/vendor/bootstrap/scss/bootstrap.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="/vendor/fontawesome-free/css/brands.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css' data-no-mirror>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css' data-no-mirror>
  
  <!-- Custom styles for this template -->
  <link href="/scss/clean-blog.css" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/themes/prism.css">

  <!-- Lunr search -->
    <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.0.3/dist/pako_inflate.min.js"></script>
    <script src="/search.js"></script>
  
  


  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">Notes from Qubit Inc.</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="/tags">Tags</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/posts">Posts</a>
            </li>
</ul>
        <form class="form-inline my-2 my-lg-0" action="/search" method="GET">
          <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="query">
          <input type="submit" hidden />
        </form>
    </div>
  </div>
</nav>

  <!-- Page Header -->
  <header class="masthead">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="post-heading">
          <h1>
            dotnet core Hello World with Entity Framework and Database
          </h1>
              <div class="meta">Published on Thursday, 12 August 2021</div>
                <div class="mt-3">
                      <a href="/tags/dotnet-core" class="badge badge-light"> dotnet core</a>
                      <a href="/tags/entity-framework" class="badge badge-light"> entity framework</a>
                </div>
        </div>
      </div>
    </div>
  </div>
</header>

  <!-- Main Content -->
  <div class="container"> 
    <div class="row">
      <div id="content" class="col-md-12">  
        <h2 id="razor-pages-app">Razor Pages App</h2>
<p>We follow this primary reference documentation, <a href="https://docs.microsoft.com/en-us/aspnet/core/data/ef-rp/intro">MS Docs - aspnet/core/data/ef-rp/intro</a></p>
<pre><code>dotnet new webapp -n P03_ContosoUniversity_RP
cd P03_ContosoUniversity_RP

dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design
dotnet add package Microsoft.EntityFrameworkCore.SQLite
dotnet add package Microsoft.EntityFrameworkCore.SqlServer
dotnet add package Microsoft.EntityFrameworkCore.Design
dotnet add package Microsoft.EntityFrameworkCore.Tools

dotnet add package Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore

dotnet aspnet-codegenerator razorpage -m Student -dc ContosoUniversity.Data.SchoolContext `
-udl -outDir Pages\Students --referenceScriptLibraries
</code></pre>
<p>If we are using SQLite database,</p>
<pre><code>dotnet aspnet-codegenerator razorpage -m Student -dc ContosoUniversity.Data.SchoolContext `
-udl -outDir Pages\Students --referenceScriptLibraries -sqlite
</code></pre>
<p>We refactor all <code>P03_ContosoUniversity_RP</code> with <code>ContosoUniversity</code>.</p>
<p>Scaffolding source files have <code>context.Student</code> which is not correct. We update those with <code>context.Students</code>.</p>
<pre><code>dotnet tool update --global dotnet-ef
dotnet ef database update
</code></pre>
<p>EF supports dev environment as well,</p>
<pre><code>dotnet ef database update -- --environment Development
</code></pre>
<p>Finally, we run it,</p>
<pre><code>$Env:ASPNETCORE_ENVIRONMENT = &quot;Development&quot;
dotnet run
</code></pre>
<p>There's some differences with the cu50 sample.</p>
<ul>
<li><p><code>Pages\Students\Index.cshtml.cs</code> is much larger not just one line,</p>
<p>Student = await _context.Students.ToListAsync();</p>
</li>
<li><p>Indentations under <code>Data</code> folder</p>
</li>
<li><p>Code for Error messages, logger etc in a number of files</p>
</li>
<li><p>they have some region definitions with snippet names</p>
</li>
</ul>
<p>In summary, the actual cu50 sample is much more complete than the one we create by following the tutorial.</p>
<p>Some observations,</p>
<ul>
<li>localdb mdf files are usually stored at <code>$HOME</code> (for example, <code>C:\Users\YOUR_NAME</code>)</li>
</ul>
<h3 id="references">References</h3>
<p><strong>Refs on Razor Pages</strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/aspnet/core/razor-pages">Razor Pages</a></li>
<li><a href="https://www.learnrazorpages.com/razor-pages/handler-methods">learnrazorpages - Handler Methods in Razor Pages</a></li>
</ul>
<p><strong>Refs on Entity Framework Performance</strong></p>
<ul>
<li><a href="https://medium.com/swlh/entity-framework-common-performance-mistakes-cdb8861cf0e7">Common performance mistakes</a></li>
</ul>
<p><strong>Example to connect from Visual Studio Server Explorer</strong></p>
<pre><code>Server Name: (LocalDb)\MSSQLLocalDB
DB: CU-1
</code></pre>
<p>ref: 1. <a href="https://docs.microsoft.com/en-us/aspnet/mvc/overview/getting-started/introduction/creating-a-connection-string">connection strings example</a>, 2. <a href="https://stackoverflow.com/questions/21563940/how-to-connect-to-localdb-in-visual-studio-server-explorer">how to connect database in visual studio data explorer</a></p>
<h2 id="mvc-app">MVC App</h2>
<p>Steps</p>
<pre><code>dotnet new mvc -n P03_ContosoUniversity
</code></pre>
<p>Replace <code>P03_ContosoUniversity</code> with 'Contoso University'.</p>
<pre><code>dotnet add package Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore
</code></pre>
<p>Primary reference documentation, <a href="https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/intro">MS Docs - aspnet/core/data/ef-mvc/intro</a></p>
<p>We add default connection in <code>appsettings.Development.json</code>. We pretty much follow the steps in tutorial and able to produce working version. Only, using VS Code instead of Visual Studio Pro is bit of work since all CLI commands are not provided and we need to repro them, especially scaffolding ones.</p>
<h2 id="razor-pages-app-net-core">Razor Pages App (net core)</h2>
<p>This is an experiment to run the EF Core Razor App with .net core,</p>
<p>We update net framework target in <code>.csproj</code> file.</p>
<p>We add following nuget packages,</p>
<pre><code>dotnet new webapp -n P03_ContosoUniversity_netcore
dotnet add package Microsoft.EntityFrameworkCore.Design
dotnet add package Microsoft.EntityFrameworkCore
dotnet add package Microsoft.EntityFrameworkCore.SQLite
</code></pre>
<p>We add all the scaffolding files from previous project (above) that targets .net6</p>
<p>We end up finding that the following method calls:</p>
<pre><code>// in ConfigureServices
// services.AddDatabaseDeveloperPageExceptionFilter();
// in Configure
// app.UseMigrationsEndPoint();
</code></pre>
<p>require <code>Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore</code> package,</p>
<pre><code>dotnet add package Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore
Determining projects to restore...
Writing C:\Users\atiq\AppData\Local\Temp\tmp6CF5.tmp
info : Adding PackageReference for package 'Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore' into project 'D:\Code\CS\P03_ContosoUniversity_netcore\P03_ContosoUniversity_netcore.csproj'.
info :   GET https://api.nuget.org/v3/registration5-gz-semver2/microsoft.aspnetcore.diagnostics.entityframeworkcore/index.json
info :   OK https://api.nuget.org/v3/registration5-gz-semver2/microsoft.aspnetcore.diagnostics.entityframeworkcore/index.json 419ms
info : Restoring packages for D:\Code\CS\P03_ContosoUniversity_netcore\P03_ContosoUniversity_netcore.csproj...
error: NU1202: Package Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore 5.0.9 is not compatible with netcoreapp3.1 (.NETCoreApp,Version=v3.1). Package Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore 5.0.9 supports: net5.0 (.NETCoreApp,Version=v5.0)
error: Package 'Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore' is incompatible with 'all' frameworks in project 'D:\Code\CS\P03_ContosoUniversity_netcore\P03_ContosoUniversity_netcore.csproj'
</code></pre>
<p>Also, the old version (3.1.18 supports .net core) of <code>Diagnostics.EntityFrameworkCore</code> doesn't have the definitions mentioned above.</p>
<p>Conclusion: since some of the packages i.e., <code>Diagnostics.EntityFrameworkCore</code> don't target .net core and only targets newer versions of net framework, for example, .net 6. We cannot run the examples from official tutorial that uses EF Core or Diagnostics (may be Logging package as well).</p>




<div id="giscus_thread"></div>
<script src="https://giscus.app/client.js"
        data-repo="atiq-cs/note"
        data-repo-id="R_kgDOGMJt-w"
        data-category="Announcements"
        data-category-id="DIC_kwDOGMJt-84B_XUr"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="dark"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the comments powered by giscus.</noscript>
      </div>
    </div>
  </div>

  <hr>

  <!-- Footer -->  
  <footer>
    <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted m-0">Copyright &#xA9; 2021</p>
                    <br />
                    <ul class="list-inline text-center small">
                            <li class="list-inline-item">
                                <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
                            </li>
                            <li class="list-inline-item">
                                <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                            </li>
                    </ul>
                    <br />
                    <div class="font-weight-bold small"><a href="https://statiq.dev">Generated by Statiq</a></div>
                </div>
        </div>
    </div>
</footer>

  <!-- Bootstrap core JavaScript -->
  <script src="/vendor/jquery/jquery.min.js"></script>
  <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  


  

  <!-- Custom scripts for this template -->
  <script src="/js/clean-blog.js"></script>

</body>

</html>
